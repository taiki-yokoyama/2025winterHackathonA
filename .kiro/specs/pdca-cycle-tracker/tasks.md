# 実装計画

- [x] 1. データベースとプロジェクト構造のセットアップ






  - データベーススキーマを作成（users、issues、caps、commentsテーブル）
  - 既存のdocker-compose.ymlを確認し、必要に応じて調整
  - データベース接続ファイル（dbconnect.php）を確認・更新
  - _要件: 10.1, 10.3, 10.4, 10.5, 10.6_

- [x] 2. 認証システムの実装




  - [x] 2.1 サインアップ機能の実装


    - signup.phpを作成（フォーム表示と処理）
    - バリデーション関数を実装（メール、パスワード、名前）
    - ユーザー作成処理を実装
    - セッション開始とTop画面へのリダイレクト
    - _要件: 1.1, 1.2, 1.3, 1.4_
  
  - [x] 2.2 ログイン機能の実装


    - login.phpを作成（フォーム表示と処理）
    - 認証ロジックを実装
    - セッション管理を実装
    - _要件: 2.1, 2.2, 2.3, 2.4_
  
  - [x] 2.3 ログアウト機能の実装


    - logout.phpを作成
    - セッション破棄処理を実装
    - _要件: 2.5_

- [x] 3. 課題（Issue）管理機能の実装




  - [x] 3.1 課題作成機能の実装


    - create_issue.phpを作成（フォーム表示と処理）
    - バリデーション関数を実装
    - 指標タイプ（percentage、scale_5、numeric）の選択UI
    - 単位入力フィールド（数値型の場合）
    - Issue作成処理を実装
    - 編集・削除禁止のビジネスロジック
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7_

- [ ] 4. CAP投稿機能の実装（サーバーサイド）
  - [ ] 4.1 CAP作成ページの基本構造
    - create_cap.phpを作成
    - ユーザーの全Issue取得処理
    - _要件: 4.1_
  
  - [ ] 4.2 CAP投稿処理の実装
    - POSTデータ受信処理（複数Issue分）
    - バリデーション処理（全項目必須チェック）
    - 各IssueごとにCAPレコード作成
    - Timeline画面へのリダイレクト
    - 編集・削除禁止のビジネスロジック
    - _要件: 4.5, 4.6, 4.7, 4.8, 4.9, 4.10_

- [ ] 5. CAP投稿機能の実装（クライアントサイド）
  - [ ] 5.1 JavaScriptによる画面遷移制御
    - cap_form.jsを作成
    - ステップ1: 全課題のCheck値入力画面
    - ステップ2: 全課題のグラフ表示画面
    - ステップ3: 全課題のAction入力画面（分析、改善方向）
    - ステップ4: 全課題のPlan入力画面
    - ページリロードなしでの画面遷移
    - 前の画面に戻るボタンの実装
    - クライアント側でのデータ保持
    - _要件: 4.2, 4.3, 4.4_

- [ ] 6. グラフ表示機能の実装
  - [ ] 6.1 グラフライブラリの統合
    - Chart.jsをプロジェクトに追加
    - グラフ描画用のJavaScript関数を作成
  
  - [ ] 6.2 CAP履歴取得とグラフ生成
    - 直近8週間のCAP履歴取得API/関数を実装
    - データ不足時の処理（存在するデータのみ表示）
    - 指標タイプ別のグラフ生成ロジック
    - パーセンテージ・数値: 折れ線グラフ
    - 五段階尺度: 適切なグラフ形式
    - 新規Check値のプレビュー表示
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [ ] 7. Timeline画面の実装
  - [ ] 7.1 Timeline基本表示
    - timeline.phpを作成
    - URLパラメータからuser_idを取得
    - 対象ユーザーの全CAP投稿を時系列で取得
    - CAP投稿の表示（課題名、Check値、分析、改善方向、計画、投稿日時）
    - コメント数の表示
    - _要件: 6.1, 6.2, 6.3, 6.4_
  
  - [ ] 7.2 Issueタブによるフィルタリング
    - Issue別タブUIの実装
    - タブ切り替え時のフィルタリング処理
    - _要件: 6.5_
  
  - [ ] 7.3 コメント表示
    - 各CAPに紐づくコメントの取得
    - 複数コメントの表示
    - 新しい順でのソート
    - _要件: 6.6, 7.5_

- [ ] 8. コメント機能の実装
  - [ ] 8.1 コメント投稿機能
    - add_comment.phpを作成
    - コメント入力フォームの実装
    - コメント作成処理（from_user_id、to_user_id、to_cap_id、comment）
    - Timeline画面へのリダイレクト
    - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 9. Top画面（ダッシュボード）の実装
  - [ ] 9.1 Top画面の基本構造
    - index.php（またはtop.php）を作成
    - ログインユーザーの全Issue取得
    - 課題一覧の表示（課題名、指標タイプ、最新Check値）
    - _要件: 8.1, 8.2_
  
  - [ ] 9.2 自分宛コメント一覧
    - to_user_idでフィルタリングしたコメント取得
    - コメント一覧の表示（送信者、内容、対象CAP、投稿日時）
    - _要件: 8.3, 8.4_
  
  - [ ] 9.3 サマリーグラフ表示
    - 各Issueの直近8週間のCAP取得
    - 小さめのサマリー形式でグラフ表示
    - データ不足時の処理
    - _要件: 8.5, 8.6_

- [ ] 10. ユーザー一覧画面の実装
  - [ ] 10.1 ユーザー一覧表示
    - users.phpを作成
    - 全ユーザーの取得
    - ユーザー一覧の表示（名前、メールアドレス）
    - 各ユーザーのTimelineへのリンク
    - _要件: 9.1, 9.2, 9.3_

- [ ] 11. エラーハンドリングの実装
  - [ ] 11.1 バリデーションエラー処理
    - PHPセッション変数を使用したエラーメッセージの保存・表示
    - 各フォームでのエラー表示実装
    - _要件: 3.3, 4.5_
  
  - [ ] 11.2 データベースエラー処理
    - try-catchによるエラーハンドリング
    - 適切なエラーコードの表示
    - エラーログの記録
    - _要件: 10.2_

- [ ] 12. セキュリティ対策の実装
  - [ ] 12.1 基本的なセキュリティ対策
    - PDOプリペアドステートメントの使用（SQLインジェクション対策）
    - htmlspecialchars()による出力エスケープ（XSS対策）
    - session_regenerate_id()の使用（セッションハイジャック対策）
    - 保護されたページでの認証チェック

- [ ] 13. UI/UXの調整
  - [ ] 13.1 スタイリング
    - CSSファイルの作成・調整
    - レスポンシブデザインは不要（デスクトップのみ）
    - フォームのスタイリング
    - ボタン、リンクのスタイリング
  
  - [ ] 13.2 ナビゲーション
    - 共通ヘッダー/ナビゲーションの実装
    - ログイン状態に応じたメニュー表示
    - 各画面へのリンク

- [ ] 14. 最終チェックポイント - 全テストの実行
  - 全ての機能が正常に動作することを確認
  - ユーザーフローのテスト（サインアップ→Issue作成→CAP投稿→Timeline表示→コメント）
  - エラーケースのテスト
  - 質問があれば、ユーザーに確認
